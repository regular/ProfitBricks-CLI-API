#!/bin/bash

#
# ProfitBricks API CLI auto-updater
#
# (C)2012, ProfitBricks GmbH
# support@profitbricks.com
#
# This program is launched by src/pbcli.py, you can launch it yourself if you want
#

echo -n 'Checking for updates: '
exit_code=0

if [ -d "$(dirname $(readlink -f $0))/.git" ]; then # we have a ".git" directory
	if [ "$(which git 2>&1 >/dev/null ; echo $?)" -eq "0" ]; then # we have the git application
		git pull | grep 'files changed' | grep 'insertions' | grep 'deletions'
		exit_code=$( if [ "$?" -eq "0" ]; then echo -n 1; else echo -n 0; fi ) # = 0 if nothing happened, = 1 if we updated
		[ "$exit_code" -ne "0" ] && ( echo '# WARNING: Please review the license file before continuing. The terms and conditions may have changed since the last update!' )
	else
		echo 'Nothing to do (git not found)'
	fi
else
	echo 'Local git repository not found'
fi

exit $exit_code

